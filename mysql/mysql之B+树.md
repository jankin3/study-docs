# mysql之B+树

### 问题1：1000w数据的B+ 树有几层高呢？

通过B+  树的结构我们知道，要计算2层的B+树的存储的数据量，计算公式是：根节点的指针数*叶子节点的记录行数

>  一个概念：`最小存储单元`,文件系统的最小存储单元一般是4k，innodb的引擎也有自己的最小存储单元-页(page), 大小为16k

根节点的指针数：我们假设主键 ID 为 bigint 类型，长度为 8 字节，而指针大小在 InnoDB 源码中设置为 6 字节，这样一共 14 字节，我们一个页中能存放多少这样的单元，其实就代表有多少指针，即 16384/14=1170



叶子节点记录行数：16K/1K=16（这里假设一行记录的数据大小为 1k）

所以，1170*1170*16=21902400  可以存储2000w数据，1000w数据也只需要两层

参考：https://www.jianshu.com/p/3578beed5a68



### 问题2： InnoDB为什么选择B+树结构？

问为什么会选择B+树，这里实际是需要和潜在的备选（B树，哈希）等比较

1. `哈希`：哈希对于等值查询的时间复杂度是O(1),非常快速。但是对于我们经常使用的范围查询或者排序问题，就显得很鸡肋，必须使用全表扫描低效的方式
2. B 树: b 树和b+树的结果非常接近，区别在于b树的非叶子节点可以存储数据。造成的问题就是节点存储的数据数量会变小，这时就会磁盘产生切换扇区，发生IO,对于查询性能很有影响

参考：https://draveness.me/whys-the-design-mysql-b-plus-tree/

